language: node_js

git:
    # Do not take whole history, but ensure to not break things:
    # - Merging multiple PR's around same time may introduce a case where it's not
    #   the last merge commit that is to be tested
    # - Aside of merge commit we need a previous commit to be able to detect a version switch
    depth: 10

branches:
    only:
        - master # Do not build PR branches
        - /^v\d+\.\d+\.\d+$/ # Ensure to build release tags

stages:
    - name: Test

jobs:
    include:
        # master branch
        - name: "Test - Node.js v12"
          if: branch = master AND type = push
          node_js: 12
          script: git tag foo && git push --tags
