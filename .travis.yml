language: node_js

git:
    # Do not take whole history, but ensure to not break things:
    # - Merging multiple PR's around same time may introduce a case where it's not
    #   the last merge commit that is to be tested
    # - Aside of merge commit we need a previous commit to be able to detect a version switch
    depth: 10

branches:
    only:
        - master # Do not build PR branches
        - /^v\d+\.\d+\.\d+$/ # Ensure to build release tags

stages:
    - name: Test

jobs:
    include:
        # master branch
        - name: "Test - Node.js v12"
          if: branch = master AND type = push
          env:
              - secure: "SkOfCgP58BUhuBu2T4RJHCESl2hNU40NUg7Pa8PW/QgXbnczT0hBGAkoO1pWPkcU672qsCH66ATcmPgeAtAvIouxygh2yNOK1WXsmgpn/3Bdq4XufL/ESjRymPIu/FLbvcvkUGzUwTp1RH2ASiRNWB54RAoiOW6umI04QTrzjk8w/MoFHRvYlf7glJG2f4U3Z9cR/rSRFPMGpGukXl81okTaCbeGkj8f3JyKwcviwpcQhF+u9En2GG95BQyWevdWVaNfqST0fllMdMM5wD+8AlpN3cS0slzREU/9qbOt2v4RpVmQrokhPE+9WYXOB1MlbUKXSl/yzTxPF62Q9bcobO/m6pG+Rtvcc6EvcgYo2XEbPhpZbwx0yqrLInbzviBMr5i42iQ9CPOhTcd71zUmL1EdSNHw1/N5vyc8AYyjzdM2xhLFoe8pg+um8F3KRbpFwX+FTeLVk8DJg6U8ZyuEMXN3cIVF6UqcOnvipZXiRs3knViafEMSlXMjZoNoVXJXDTa79HTes28gjsZRFY6kogESmSV528yDhYUX/SjTxDNFq0d2SyR5R2U5YLTshFi7z+/DXYDK/F+UbOKxL8pe6D1YpHq/vG3eV90UDOxaqU5OpMuMbQO7GOW8DcqLVZ64UspG1PPsGP/JjB3kdZpzPnziJIMXA8TWSyTG8DZTrs4="
          node_js: 12
          script:
              - ls -la
              - git status
              - git tag foo && git push -q https://$GITHUB_TOKEN@github.com/medikoo/package-local-test --tags
